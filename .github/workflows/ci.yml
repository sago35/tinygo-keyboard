name: CI

on: [push]

jobs:
  smoketest:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: tinygo-dev
      run: |
        go version
        docker pull tinygo/tinygo-dev
        docker run --rm -v $GITHUB_WORKSPACE:/workspace -w /workspace tinygo/tinygo-dev tinygo version
        docker run --rm -v $GITHUB_WORKSPACE:/workspace -w /workspace tinygo/tinygo-dev ls -la
        docker run --rm -v $GITHUB_WORKSPACE:/workspace -w /workspace tinygo/tinygo-dev /bin/sh -c "go mod tidy && git config --global --add safe.directory /workspace && make smoketest"
